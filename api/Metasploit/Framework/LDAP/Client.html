<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Metasploit::Framework::LDAP::Client
  
    &mdash; Documentation by YARD 0.9.34
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Metasploit::Framework::LDAP::Client";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Framework.html" title="Metasploit::Framework (module)">Framework</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../LDAP.html" title="Metasploit::Framework::LDAP (module)">LDAP</a></span></span>
     &raquo; 
    <span class="title">Client</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Metasploit::Framework::LDAP::Client
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../LoginScanner/LDAP.html" title="Metasploit::Framework::LoginScanner::LDAP (class)">Metasploit::Framework::LoginScanner::LDAP</a></span>, <span class='object_link'><a href="../../../Msf/Exploit/Remote/LDAP.html" title="Msf::Exploit::Remote::LDAP (module)">Msf::Exploit::Remote::LDAP</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/metasploit/framework/ldap/client.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ldap_connect_opts-instance_method" title="#ldap_connect_opts (instance method)">#<strong>ldap_connect_opts</strong>(rhost, rport, connect_timeout, ssl: true, opts: {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="ldap_connect_opts-instance_method">
  
    #<strong>ldap_connect_opts</strong>(rhost, rport, connect_timeout, ssl: true, opts: {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/metasploit/framework/ldap/client.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ldap_connect_opts'>ldap_connect_opts</span><span class='lparen'>(</span><span class='id identifier rubyid_rhost'>rhost</span><span class='comma'>,</span> <span class='id identifier rubyid_rport'>rport</span><span class='comma'>,</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='comma'>,</span> <span class='label'>ssl:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='label'>opts:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_connect_opts'>connect_opts</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>host:</span> <span class='id identifier rubyid_rhost'>rhost</span><span class='comma'>,</span>
    <span class='label'>port:</span> <span class='id identifier rubyid_rport'>rport</span><span class='comma'>,</span>
    <span class='label'>connect_timeout:</span> <span class='id identifier rubyid_connect_timeout'>connect_timeout</span><span class='comma'>,</span>
    <span class='label'>proxies:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:proxies</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_ssl'>ssl</span>
    <span class='id identifier rubyid_connect_opts'>connect_opts</span><span class='lbracket'>[</span><span class='symbol'>:encryption</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>method:</span> <span class='symbol'>:simple_tls</span><span class='comma'>,</span>
      <span class='label'>tls_options:</span> <span class='lbrace'>{</span>
        <span class='label'>verify_mode:</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_NONE</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ldap_auth</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html" title="Msf::Exploit::Remote::AuthOption (module)">AuthOption</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html#SCHANNEL-constant" title="Msf::Exploit::Remote::AuthOption::SCHANNEL (constant)">SCHANNEL</a></span></span>
    <span class='id identifier rubyid_pfx_path'>pfx_path</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ldap_cert_file</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/ValidationError.html" title="Msf::ValidationError (class)">ValidationError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The LDAP::CertFile option is required when using SCHANNEL authentication.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_pfx_path'>pfx_path</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/ValidationError.html" title="Msf::ValidationError (class)">ValidationError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The SSL option must be enabled when using SCHANNEL authentication.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_ssl'>ssl</span> <span class='op'>!=</span> <span class='kw'>true</span>

    <span class='kw'>unless</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span><span class='lparen'>(</span><span class='id identifier rubyid_pfx_path'>pfx_path</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_readable?'>readable?</span><span class='lparen'>(</span><span class='id identifier rubyid_pfx_path'>pfx_path</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/ValidationError.html" title="Msf::ValidationError (class)">ValidationError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Failed to load the PFX certificate file. The path was not a readable file.</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_pkcs'>pkcs</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKCS12</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_binread'>binread</span><span class='lparen'>(</span><span class='id identifier rubyid_pfx_path'>pfx_path</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/ValidationError.html" title="Msf::ValidationError (class)">ValidationError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to load the PFX file (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_connect_opts'>connect_opts</span><span class='lbracket'>[</span><span class='symbol'>:auth</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>method:</span> <span class='symbol'>:sasl</span><span class='comma'>,</span>
      <span class='label'>mechanism:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>EXTERNAL</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>initial_credential:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>challenge_response:</span> <span class='kw'>true</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_connect_opts'>connect_opts</span><span class='lbracket'>[</span><span class='symbol'>:encryption</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>method:</span> <span class='symbol'>:start_tls</span><span class='comma'>,</span>
      <span class='label'>tls_options:</span> <span class='lbrace'>{</span>
        <span class='label'>verify_mode:</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_NONE</span><span class='comma'>,</span>
        <span class='label'>cert:</span> <span class='id identifier rubyid_pkcs'>pkcs</span><span class='period'>.</span><span class='id identifier rubyid_certificate'>certificate</span><span class='comma'>,</span>
        <span class='label'>key:</span> <span class='id identifier rubyid_pkcs'>pkcs</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>
      <span class='rbrace'>}</span>
    <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html" title="Msf::Exploit::Remote::AuthOption (module)">AuthOption</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html#KERBEROS-constant" title="Msf::Exploit::Remote::AuthOption::KERBEROS (constant)">KERBEROS</a></span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/ValidationError.html" title="Msf::ValidationError (class)">ValidationError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The Ldap::Rhostname option is required when using Kerberos authentication.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ldap_rhostname</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/ValidationError.html" title="Msf::ValidationError (class)">ValidationError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The DOMAIN option is required when using Kerberos authentication.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:domain</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_offered_etypes'>offered_etypes</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html" title="Msf::Exploit::Remote::AuthOption (module)">AuthOption</a></span></span><span class='period'>.</span><span class='id identifier rubyid_as_default_offered_etypes'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html#as_default_offered_etypes-class_method" title="Msf::Exploit::Remote::AuthOption.as_default_offered_etypes (method)">as_default_offered_etypes</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ldap_krb_offered_enc_types</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/ValidationError.html" title="Msf::ValidationError (class)">ValidationError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>At least one encryption type is required when using Kerberos authentication.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_offered_etypes'>offered_etypes</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='id identifier rubyid_kerberos_authenticator'>kerberos_authenticator</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/Kerberos.html" title="Msf::Exploit::Remote::Kerberos (module)">Kerberos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/Kerberos/ServiceAuthenticator.html" title="Msf::Exploit::Remote::Kerberos::ServiceAuthenticator (class)">ServiceAuthenticator</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/Kerberos/ServiceAuthenticator/LDAP.html" title="Msf::Exploit::Remote::Kerberos::ServiceAuthenticator::LDAP (class)">LDAP</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../../Msf/Exploit/Remote/Kerberos/ServiceAuthenticator/Base.html#initialize-instance_method" title="Msf::Exploit::Remote::Kerberos::ServiceAuthenticator::Base#initialize (method)">new</a></span></span><span class='lparen'>(</span>
      <span class='label'>host:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:domain_controller_rhost</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:domain_controller_rhost</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>hostname:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ldap_rhostname</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>realm:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:domain</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>username:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>password:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>framework:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:framework</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>framework_module:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:framework_module</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>cache_file:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ldap_krb5_cname</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ldap_krb5_cname</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>ticket_storage:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:kerberos_ticket_storage</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>offered_etypes:</span> <span class='id identifier rubyid_offered_etypes'>offered_etypes</span>
    <span class='rparen'>)</span>

    <span class='id identifier rubyid_connect_opts'>connect_opts</span><span class='lbracket'>[</span><span class='symbol'>:auth</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>method:</span> <span class='symbol'>:sasl</span><span class='comma'>,</span>
      <span class='label'>mechanism:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GSS-SPNEGO</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>initial_credential:</span> <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_kerberos_result'>kerberos_result</span> <span class='op'>=</span> <span class='id identifier rubyid_kerberos_authenticator'>kerberos_authenticator</span><span class='period'>.</span><span class='id identifier rubyid_authenticate'>authenticate</span>
        <span class='id identifier rubyid_kerberos_result'>kerberos_result</span><span class='lbracket'>[</span><span class='symbol'>:security_blob</span><span class='rbracket'>]</span>
      <span class='kw'>end</span><span class='comma'>,</span>
      <span class='label'>challenge_response:</span> <span class='kw'>true</span>
    <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html" title="Msf::Exploit::Remote::AuthOption (module)">AuthOption</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html#NTLM-constant" title="Msf::Exploit::Remote::AuthOption::NTLM (constant)">NTLM</a></span></span>
    <span class='id identifier rubyid_ntlm_client'>ntlm_client</span> <span class='op'>=</span> <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>workstation:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WORKSTATION</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>domain:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:domain</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:domain</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>flags:</span>
        <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>NEGOTIATE_FLAGS</span><span class='lbracket'>[</span><span class='symbol'>:UNICODE</span><span class='rbracket'>]</span> <span class='op'>|</span>
          <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>NEGOTIATE_FLAGS</span><span class='lbracket'>[</span><span class='symbol'>:REQUEST_TARGET</span><span class='rbracket'>]</span> <span class='op'>|</span>
          <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>NEGOTIATE_FLAGS</span><span class='lbracket'>[</span><span class='symbol'>:NTLM</span><span class='rbracket'>]</span> <span class='op'>|</span>
          <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>NEGOTIATE_FLAGS</span><span class='lbracket'>[</span><span class='symbol'>:ALWAYS_SIGN</span><span class='rbracket'>]</span> <span class='op'>|</span>
          <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>NEGOTIATE_FLAGS</span><span class='lbracket'>[</span><span class='symbol'>:EXTENDED_SECURITY</span><span class='rbracket'>]</span> <span class='op'>|</span>
          <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>NEGOTIATE_FLAGS</span><span class='lbracket'>[</span><span class='symbol'>:KEY_EXCHANGE</span><span class='rbracket'>]</span> <span class='op'>|</span>
          <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>NEGOTIATE_FLAGS</span><span class='lbracket'>[</span><span class='symbol'>:TARGET_INFO</span><span class='rbracket'>]</span> <span class='op'>|</span>
          <span class='const'>RubySMB</span><span class='op'>::</span><span class='const'>NTLM</span><span class='op'>::</span><span class='const'>NEGOTIATE_FLAGS</span><span class='lbracket'>[</span><span class='symbol'>:VERSION_INFO</span><span class='rbracket'>]</span>
    <span class='rparen'>)</span>

    <span class='id identifier rubyid_negotiate'>negotiate</span> <span class='op'>=</span> <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_challenge'>challenge</span><span class='op'>|</span>
      <span class='id identifier rubyid_ntlmssp_offset'>ntlmssp_offset</span> <span class='op'>=</span> <span class='id identifier rubyid_challenge'>challenge</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>NTLMSSP</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_type2_blob'>type2_blob</span> <span class='op'>=</span> <span class='id identifier rubyid_challenge'>challenge</span><span class='period'>.</span><span class='id identifier rubyid_slice'>slice</span><span class='lparen'>(</span><span class='id identifier rubyid_ntlmssp_offset'>ntlmssp_offset</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_challenge'>challenge</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_type2_blob'>type2_blob</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>m</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_type3_message'>type3_message</span> <span class='op'>=</span> <span class='id identifier rubyid_ntlm_client'>ntlm_client</span><span class='period'>.</span><span class='id identifier rubyid_init_context'>init_context</span><span class='lparen'>(</span><span class='id identifier rubyid_challenge'>challenge</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_type3_message'>type3_message</span><span class='period'>.</span><span class='id identifier rubyid_serialize'>serialize</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_connect_opts'>connect_opts</span><span class='lbracket'>[</span><span class='symbol'>:auth</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>method:</span> <span class='symbol'>:sasl</span><span class='comma'>,</span>
      <span class='label'>mechanism:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GSS-SPNEGO</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>initial_credential:</span> <span class='id identifier rubyid_ntlm_client'>ntlm_client</span><span class='period'>.</span><span class='id identifier rubyid_init_context'>init_context</span><span class='period'>.</span><span class='id identifier rubyid_serialize'>serialize</span><span class='comma'>,</span>
      <span class='label'>challenge_response:</span> <span class='id identifier rubyid_negotiate'>negotiate</span>
    <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html" title="Msf::Exploit::Remote::AuthOption (module)">AuthOption</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html#PLAINTEXT-constant" title="Msf::Exploit::Remote::AuthOption::PLAINTEXT (constant)">PLAINTEXT</a></span></span>
    <span class='id identifier rubyid_connect_opts'>connect_opts</span><span class='lbracket'>[</span><span class='symbol'>:auth</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>method:</span> <span class='symbol'>:simple</span><span class='comma'>,</span>
      <span class='label'>username:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='label'>password:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span>
    <span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='const'><span class='object_link'><a href="../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html" title="Msf::Exploit::Remote::AuthOption (module)">AuthOption</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Msf/Exploit/Remote/AuthOption.html#AUTO-constant" title="Msf::Exploit::Remote::AuthOption::AUTO (constant)">AUTO</a></span></span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='comment'># plaintext if specified
</span>      <span class='id identifier rubyid_connect_opts'>connect_opts</span><span class='lbracket'>[</span><span class='symbol'>:auth</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
        <span class='label'>method:</span> <span class='symbol'>:simple</span><span class='comma'>,</span>
        <span class='label'>username:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span><span class='comma'>,</span>
        <span class='label'>password:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_connect_opts'>connect_opts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Jan 11 12:27:31 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-3.0.2).
</div>

    </div>
  </body>
</html>